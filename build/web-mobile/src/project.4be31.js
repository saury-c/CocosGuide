__require=function e(t,i,o){function n(r,c){if(!i[r]){if(!t[r]){var a=r.split("/");if(a=a[a.length-1],!t[a]){var u="function"==typeof __require&&__require;if(!c&&u)return u(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+r+"'")}}var _=i[r]={exports:{}};t[r][0].call(_.exports,function(e){return n(t[r][1][e]||e)},_,_.exports,e,t,i,o)}return i[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<o.length;r++)n(o[r]);return n}({EventNotice:[function(e,t,i){"use strict";cc._RF.push(t,"575e244+zxALYVoUJeDhhGO","EventNotice"),Object.defineProperty(i,"__esModule",{value:!0}),function(e){var t=new Map;e.add=function(e,i){var o=t.get(e)||[];o.push(i),t.set(e,o)},e.remove=function(e,i){var o=t.get(e);if(!o||o.length<1)return!1;var n=o.indexOf(i);return-1!=n?(o.splice(n,1),!0):void 0},e.emit=function(e){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var n=t.get(e);!n||n.length<1||n.forEach(function(e,t){e(i)})}}(i.EventNotice||(i.EventNotice={})),cc._RF.pop()},{}],GuideConfig:[function(e,t,i){"use strict";var o;cc._RF.push(t,"9cde6hyWRpJgodwh2bu5kHe","GuideConfig"),Object.defineProperty(i,"__esModule",{value:!0});var n,s=e("../../event/EventNotice"),r=e("./GuideFunUtils");i.GUIDE_PREFIX="GUIDEGUIDEGUIDE_",i.GUIDE_CFG_NODE_PATH={1:{path:"Canvas/cocos1",des:"\u7b2c\u4e00\u4e2a\u6309\u94ae"},2:{path:"Canvas/cocos2",des:"\u6309\u94ae"},3:{path:"Canvas/open",des:"\u6253\u5f00\u5f39\u7a97\u6309\u94ae"}},i.GUIDE_CFG_NODE_EVENT={foo1:{des:"\u67e5\u627e\u5f39\u7a97\u5173\u95ed\u6309\u94ae",callback:function(){return r.GuideGameUtils.findCloseBtn()}}},function(e){e.CLICK_CLOSE="e1"}(n=i.E_GUIDE_CFG_FINISH_EVENT||(i.E_GUIDE_CFG_FINISH_EVENT={})),i.GUIDE_CFG_FINISH_EVENT=((o={})[n.CLICK_CLOSE]={des:"\u6210\u529f\u5173\u95ed\u5f39\u7a97",callback:function(e){var t;s.EventNotice.add(n.CLICK_CLOSE,t=function(){s.EventNotice.remove(n.CLICK_CLOSE,t),e()})}},o),window.GUIDE_CFG_FINISH_EVENT=i.GUIDE_CFG_FINISH_EVENT,cc._RF.pop()},{"../../event/EventNotice":"EventNotice","./GuideFunUtils":"GuideFunUtils"}],GuideFunUtils:[function(e,t,i){"use strict";cc._RF.push(t,"764c2zSetZDIouW4vDuPfzy","GuideFunUtils"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=e("../../Test");(function(e){e.findCloseBtn=function(){return cc.find("Canvas").getComponent(n.default).close}})(o=i.GuideGameUtils||(i.GuideGameUtils={})),window.GuideGameUtils=o,cc._RF.pop()},{"../../Test":"Test"}],GuideManager:[function(e,t,i){"use strict";cc._RF.push(t,"15ee6LkVAtOHYv19iJ/NZbZ","GuideManager"),Object.defineProperty(i,"__esModule",{value:!0});var o,n=e("./Guide"),s=cc.Mask.prototype._hitTest;cc.Mask.prototype._hitTest=function(){return!s.apply(this,arguments)},function(e){e.guides=new Map,e.create=function(t,i){return __awaiter(this,void 0,Promise,function(){var o,s;return __generator(this,function(r){switch(r.label){case 0:return o=new n.Guide,e.guides.set(t,o),s=o.destroy,o.destroy=function(){console.log("%c \u65b0\u624b\u5f15\u5bfc\u7ed3\u675f","%color:#000000;%background:black",t),s.call(o),e.guides.delete(t)},[4,o.init(i)];case 1:return r.sent(),[2,o]}})})},e.get=function(t){return e.guides.get(t)},e.enter=function(t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return(i=e.guides.get(t))?[4,i.enter()]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},e.exit=function(t){var i=e.guides.get(t);i&&i.exit()},e.remove=function(t){var i=e.guides.get(t);i&&(i.destroy(),e.guides.delete(t))},e.exitAllGuide=function(){e.guides.forEach(function(e,t){e.destroy()})}}(o=i.guideManager||(i.guideManager={})),window.guideManager=o,cc._RF.pop()},{"./Guide":"Guide"}],GuideNormalStepUI:[function(e,t,i){"use strict";cc._RF.push(t,"8aa6br2mcVM4Y32vGFBB/hV","GuideNormalStepUI"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./GuideStepHand"),n=e("./GuideStepMask"),s=e("./GuideStepTips"),r=cc._decorator,c=r.ccclass,a=r.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hold_intercept=null,t.hollow_mask=null,t.text_tips=null,t.hand_tips=null,t}return __extends(t,e),t.prototype.hold=function(e){this.hold_intercept.active=e},t.prototype.initGuideUI=function(){this.node.active=!0,this.text_tips.isShow(!1),this.hand_tips.isShow(!1),this.hollow_mask.initMaskOpacity(0),this.hollow_mask.showMask(this.node,{width:0,height:0},!1),this.hollow_mask.activeHollowMaskComponent(!0),console.log("\u9ed8\u8ba4\u9690\u85cf\u6240\u6709\u5f15\u5bfc\u7ec4\u4ef6, \u4ec5\u663e\u793a\u900f\u660emask")},Object.defineProperty(t.prototype,"getSize",{get:function(){return this.node.getContentSize()},enumerable:!0,configurable:!0}),__decorate([a({type:cc.Node,tooltip:"\u7528\u4e8e\u5f02\u6b65\u7b49\u5f85 - \u66f2\u7ebf\u6551\u56fdhold"})],t.prototype,"hold_intercept",void 0),__decorate([a({type:n.default})],t.prototype,"hollow_mask",void 0),__decorate([a({type:s.default})],t.prototype,"text_tips",void 0),__decorate([a({type:o.default})],t.prototype,"hand_tips",void 0),t=__decorate([c],t)}(cc.Component);i.default=u,cc._RF.pop()},{"./GuideStepHand":"GuideStepHand","./GuideStepMask":"GuideStepMask","./GuideStepTips":"GuideStepTips"}],GuideNormalStep:[function(e,t,i){"use strict";cc._RF.push(t,"e711b0scwhGDa13JzBP+Ssh","GuideNormalStep"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../config/GuideConfig"),n=e("../entrance/GuideParse"),s=e("../framework/GuideStep"),r=e("./GuideNormalStepUI"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onInit=function(e){return __awaiter(this,void 0,Promise,function(){var i,o,n,s=this;return __generator(this,function(c){switch(c.label){case 0:return window.guideNormalStep=this,this.data=e,this.promises=[],(i=cc.director.getScene().getChildByName("timerNode"))||(i=new cc.Node("timerNode"),cc.game.addPersistRootNode(i),this.scheduleTemp=i.addComponent(cc.Widget)),this.scheduleTemp=i.getComponent(cc.Widget),o=this,[4,new Promise(function(e){cc.loader.loadRes(t.PrefabURL,function(t,i){e(i)})})];case 1:return o.prefab=c.sent(),n=cc.instantiate(this.prefab),cc.game.addPersistRootNode(n),this.ui=n.getComponent(r.default),this.removeNode(this.ui.node),this.showNode(this.ui.node),this._destroyed?[2]:(cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LOADING,this.eventSceneLoading=function(){s.removeNode(s.ui.node)}),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.eventSceneLaunch=function(){cc.isValid(s.ui.node)&&s.showNode(s.ui.node)}),this.runningStepGuide(),[2])}})})},t.prototype.onDestroy=function(){if(cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LOADING,this.eventSceneLoading),cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.eventSceneLaunch),this.prefab&&cc.loader.release(this.prefab),this.ui.node&&this.destroyNode(this.ui.node),this.target&&this.target.targetOff(this),0!=this.promises.length){for(var e=0,t=this.promises;e<t.length;e++){(0,t[e])(1)}this.promises.length=0}this.target=null,this.scheduleTemp.unscheduleAllCallbacks()},t.prototype.runningStepGuide=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,n;return __generator(this,function(s){switch(s.label){case 0:e=-1,t=0,i=this.data,s.label=1;case 1:return t<i.length?(o=i[t],++e,console.log("%c \u5f53\u524d\u5f15\u5bfc\u6570\u636e","%color:#333360;%background:black",e,o),this.clearGuideUI(),this.ui.hold(!0),[4,this.holdTime(o.seek_node_delay_time)]):[3,7];case 2:return s.sent(),this._destroyed?[2]:[4,this.waitNode(o)];case 3:return n=s.sent(),this.recordGuideDone(e,o),n?this._destroyed?[2]:[4,this.holdTime(o.step_guide_delay_time)]:(console.warn("\u627e\u4e0d\u5230\u8282\u70b9, \u8df3\u8fc7\u5f15\u5bfc\u6b65\u9aa4",o),this.ui.hold(!1),[3,6]);case 4:return s.sent(),this.ui.hold(!1),this._destroyed?[2]:[4,this.waitGuide(o,e)];case 5:if(s.sent(),this._destroyed)return[2];s.label=6;case 6:return t++,[3,1];case 7:return this.exit(),[2]}})})},t.prototype.recordGuideDone=function(e,t){(t.guide_finish_mark||e==this.data.length-1)&&n.GuideParse.INSTANCE().setGuideStorage(t.guide_id)},t.prototype.holdTime=function(e){var t=this;return e<=0?function(){}:new Promise(function(i){t.scheduleTemp.scheduleOnce(i,e)})},t.prototype.waitNode=function(e){var t=this;return this.target=null,new Promise(function(i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(o){switch(o.label){case 0:switch(e.seek_node_type){case n.E_GUIDE_STEP_SEEK_NODE_TYPE.PATH_FIND:return[3,1];case n.E_GUIDE_STEP_SEEK_NODE_TYPE.CALLBACK_FIND:return[3,3];case n.E_GUIDE_STEP_SEEK_NODE_TYPE.CALLBACK_FIND:return[3,5];case n.E_GUIDE_STEP_SEEK_NODE_TYPE.NOT_NEED_FIND:return[3,6]}return[3,7];case 1:return[4,this.findNodeByPath(e)];case 2:return t=o.sent(),[3,8];case 3:return[4,this.findeNodeByCallback(e)];case 4:return t=o.sent(),[3,8];case 5:case 6:case 7:return[3,8];case 8:return t&&(this.target=t,e.custom_ui={width:t.width,height:t.height}),this.promises.push(i),setTimeout(function(){i(!0)},200),[2]}})})})},t.prototype.findNodeByPath=function(e){var t=this,i=e.seek_node_param.split(",")[0],n=o.GUIDE_CFG_NODE_PATH[i]&&o.GUIDE_CFG_NODE_PATH[i].path;if(n)return new Promise(function(e){var i=function(){var o=cc.find(n);o&&(t.scheduleTemp.unschedule(i),e(o))};t.scheduleTemp.schedule(i,.2)});console.error("\u65b0\u624b\u5f15\u5bfcpath\u8def\u5f84\u914d\u7f6e\u6709\u8bef!!!")},t.prototype.findeNodeByCallback=function(e){var t=this,i=e.seek_node_param.split(",")[0],n=o.GUIDE_CFG_NODE_EVENT[i]&&o.GUIDE_CFG_NODE_EVENT[i].callback;return new Promise(function(e){var i=function(){var o=n();o&&(t.scheduleTemp.unschedule(i),e(o))};t.scheduleTemp.schedule(i,.2)})},t.prototype.waitGuide=function(e,t){var i=this;return new Promise(function(t){i.ui.hold(!0),i.refreshStepUI(),i.createMaskUI(e),i.craeteTipsTextUI(e),i.craeteTipsHandUI(e);var o=i.schduleTargetFollow(e);i.craeteGuideFinish(e,function(){i.unscheTargetFollow(o),t()}),i.ui.hold(!1)})},t.prototype.refreshStepUI=function(){this.removeNode(this.ui.node),this.showNode(this.ui.node),this.ui.node.getComponent(cc.Widget).updateAlignment(),this.ui.hollow_mask.refreshMaskWidget()},t.prototype.createMaskUI=function(e){if(this.ui.hollow_mask.activInterceptComponent(!0),e.mask_type==n.E_GUIDE_STEP_MASK_TYPE.NONE){var t=cc.winSize;return this.ui.hollow_mask.initMaskOpacity(0),this.ui.hollow_mask.showMask(this.ui.node,{width:t.width,height:t.height},!1),e.custom_ui={width:t.width,height:t.height},void console.log("\u7a7a\u906e\u7f69")}return e.mask_type==n.E_GUIDE_STEP_MASK_TYPE.HOLLOW?this.target?(this.ui.hollow_mask.initMaskOpacity(0),this.ui.hollow_mask.showMask(this.target,e.custom_ui,!0),void console.log("\u6316\u7a7a\u906e\u7f69")):void console.warn("\u906e\u7f69\u8282\u70b9\u4e0d\u5b58\u5728!"):e.mask_type==n.E_GUIDE_STEP_MASK_TYPE.LUCENCY_HOLLOW?this.target?(this.ui.hollow_mask.initMaskOpacity(0),this.ui.hollow_mask.showMask(this.target,e.custom_ui,!1),void console.log("\u6316\u7a7a\u906e\u7f69 - \u900f\u660e\u7248")):void console.warn("\u906e\u7f69\u8282\u70b9\u4e0d\u5b58\u5728!"):e.mask_type==n.E_GUIDE_STEP_MASK_TYPE.LUCENCY_FULL_SCENE?(this.ui.hollow_mask.initMaskOpacity(0),this.ui.hollow_mask.showMask(this.ui.node,{width:0,height:0},!1),e.custom_ui={width:0,height:0},void console.log("\u5168\u5c4f\u906e\u7f69 - \u900f\u660e")):e.mask_type==n.E_GUIDE_STEP_MASK_TYPE.LUCENCY_NO_INTERCEPT?(this.ui.hollow_mask.initMaskOpacity(0),this.ui.hollow_mask.showMask(this.ui.node,{width:0,height:0},!1),this.ui.hollow_mask.activInterceptComponent(!1),e.custom_ui={width:0,height:0},void console.log("\u5168\u5c4f\u906e\u7f69 - \u900f\u660e\u3001\u65e0\u62e6\u622a")):void 0},t.prototype.craeteTipsTextUI=function(e){e.tips_text_content?this.ui.text_tips.setStr({str:e.tips_text_content,pos:e.tips_text_position,targetNode:this.target}):this.ui.text_tips.isShow(!1)},t.prototype.craeteTipsHandUI=function(e){var t,i=this;0!=e.hand_tips_delay_time?this.scheduleTemp.schedule(t=function(){i.scheduleTemp.unschedule(t),i.ui.hand_tips.showHand({targetNode:i.target,type:e.hand_tips_type})},e.hand_tips_delay_time):this.ui.hand_tips.showHand({targetNode:this.target,type:e.hand_tips_type})},t.prototype.schduleTargetFollow=function(e){var t=this;if(cc.isValid(this.target)){var i,o=[n.E_GUIDE_STEP_MASK_TYPE.HOLLOW,n.E_GUIDE_STEP_MASK_TYPE.LUCENCY_HOLLOW];return this.scheduleTemp.schedule(i=function(){if(!cc.isValid(t.target))return t.scheduleTemp.unschedule(i),void console.warn("\u8282\u70b9\u5df2\u9500\u6bc1, \u6682\u65f6\u5173\u95ed\u8ddf\u968f - \u51fabug\u5566");o.includes(e.mask_type)?(t.ui.hollow_mask.followMask(t.target,e.custom_ui),t.ui.hand_tips.followHollowMask(t.ui.hollow_mask.node)):t.ui.hand_tips.followHollowMask(t.target),t.ui.text_tips.followMask(t.target)},.1),i}},t.prototype.unscheTargetFollow=function(e){e&&this.scheduleTemp.unschedule(e)},t.prototype.clearGuideUI=function(){this.ui.initGuideUI()},t.prototype.craeteGuideFinish=function(e,t){if(e.step_finish_type==n.E_GUIDE_STEP_FINISH_TYPE.CLICK_NODE)return this.target?(console.log("\u6ce8\u518c'\u70b9\u51fb\u8282\u70b9\u7ed3\u675f'"),void this.target.once(cc.Node.EventType.TOUCH_END,function(){console.warn("\u70b9\u51fb\u6210\u529f\uff01\u592a\u68d2\u4e86\uff01"),t()},this)):void console.error("\u6240\u9700\u70b9\u51fb\u7684\u8282\u70b9\u672a\u627e\u5230!");if(e.step_finish_type==n.E_GUIDE_STEP_FINISH_TYPE.EVENT_MONITOR){var i=e.step_finish_param.split(",")[0],s=o.GUIDE_CFG_FINISH_EVENT[i]&&o.GUIDE_CFG_FINISH_EVENT[i].callback;return s?(console.log("\u6ce8\u518c'\u76d1\u542c\u7ed3\u675f'"),void s(t)):void console.error("\u6240\u9700\u76d1\u542c\u56de\u8c03\u672a\u627e\u5230!")}return e.step_finish_type==n.E_GUIDE_STEP_FINISH_TYPE.CLICK_BLANK?e.mask_type!=n.E_GUIDE_STEP_MASK_TYPE.LUCENCY_FULL_SCENE?void console.error("\u5f53\u524d\u906e\u7f69\u4e0d\u662f\u5168\u5c4f\u906e\u7f69"):(console.log("\u6ce8\u518c'\u70b9\u51fb\u906e\u7f69\u7ed3\u675f'"),void this.ui.hollow_mask.node.on(cc.Node.EventType.TOUCH_END,function(){t()},this)):void 0},t.PrefabURL="guide_step",t}(s.GuideStep);i.GuideNormalStep=c,cc._RF.pop()},{"../config/GuideConfig":"GuideConfig","../entrance/GuideParse":"GuideParse","../framework/GuideStep":"GuideStep","./GuideNormalStepUI":"GuideNormalStepUI"}],GuideParse:[function(e,t,i){"use strict";cc._RF.push(t,"43971VgLT1IwLcFIu1OM2Tf","GuideParse"),Object.defineProperty(i,"__esModule",{value:!0});var o,n,s,r,c,a=e("../config/GuideConfig"),u=e("../framework/GuideManager");(function(e){e[e.HALL=1]="HALL",e[e.GAME=2]="GAME"})(i.E_GUIDE_SCENE||(i.E_GUIDE_SCENE={})),function(e){e[e.CLICK_NODE=1]="CLICK_NODE",e[e.EVENT_MONITOR=2]="EVENT_MONITOR",e[e.CLICK_BLANK=3]="CLICK_BLANK"}(o=i.E_GUIDE_STEP_FINISH_TYPE||(i.E_GUIDE_STEP_FINISH_TYPE={})),function(e){e[e.PATH_FIND=1]="PATH_FIND",e[e.CALLBACK_FIND=2]="CALLBACK_FIND",e[e.EVENT_MONITOR_FIND=3]="EVENT_MONITOR_FIND",e[e.NOT_NEED_FIND=4]="NOT_NEED_FIND"}(n=i.E_GUIDE_STEP_SEEK_NODE_TYPE||(i.E_GUIDE_STEP_SEEK_NODE_TYPE={})),function(e){e[e.TOP=1]="TOP",e[e.CENTER=2]="CENTER",e[e.BOTTOM=3]="BOTTOM",e[e.NODE=4]="NODE"}(s=i.E_GUIDE_STEP_TIPS_TEXT_POSTION||(i.E_GUIDE_STEP_TIPS_TEXT_POSTION={})),function(e){e[e.HIDE=1]="HIDE",e[e.SHOW=2]="SHOW"}(r=i.E_GUIDE_STEP_HAND_TIPS_TYPE||(i.E_GUIDE_STEP_HAND_TIPS_TYPE={})),function(e){e[e.NONE=1]="NONE",e[e.HOLLOW=2]="HOLLOW",e[e.LUCENCY_HOLLOW=3]="LUCENCY_HOLLOW",e[e.LUCENCY_FULL_SCENE=4]="LUCENCY_FULL_SCENE",e[e.LUCENCY_NO_INTERCEPT=5]="LUCENCY_NO_INTERCEPT"}(c=i.E_GUIDE_STEP_MASK_TYPE||(i.E_GUIDE_STEP_MASK_TYPE={}));var _=function(){function e(){this.entranceMap=new Map}return e.prototype.initAllGuide=function(){return __awaiter(this,void 0,void 0,function(){var t,i,u,_,d,h,l,p,E,f,g,N,G,T,y,v,m,I,S,w;return __generator(this,function(P){switch(P.label){case 0:return 0!=this.entranceMap.size?[2]:[4,new Promise(function(t){cc.loader.loadRes(e.JsonURL,function(e,i){t(i&&i.json)})})];case 1:for(t=P.sent(),i={},u=0,_=t;u<_.length;u++)f=_[u],i[f.guide_id]||(i[f.guide_id]=[]),i[f.guide_id].push(f);for(d in i){for(h=i[d],l=[],p=0,E=h;p<E.length;p++)f=E[p],g={guide_id:f.guide_id,trigger_scene:f.guide_scene,guide_finish_mark:f.guide_finish_mark,step_description:f.step_description,step_id:f.step_id,step_finish_type:null==f.step_finish_type?o.CLICK_BLANK:f.step_finish_type,step_finish_param:f.step_finish_param,seek_node_delay_time:null==f.seek_node_delay_time||""==f.seek_node_delay_time?0:f.seek_node_delay_time,seek_node_type:null==f.seek_node_type?n.NOT_NEED_FIND:f.seek_node_type,seek_node_param:f.seek_node_param,step_guide_delay_time:null==f.step_guide_delay_time||""==f.step_guide_delay_time?0:f.step_guide_delay_time,tips_text_content:f.tips_text_content,tips_text_position:null==f.tips_text_position?s.CENTER:f.tips_text_position,hand_tips_type:null==f.hand_tips_type?r.HIDE:f.hand_tips_type,hand_tips_delay_time:null==f.hand_tips_delay_time?0:f.hand_tips_delay_time,mask_type:null==f.mask_type?c.NONE:f.mask_type},l.push(g);N=h[0],G=+N.guide_id,T=N.guide_description,y=null==N.guide_count_limit||""==N.guide_count_limit?1:N.guide_count_limit,v=null==N.guide_depend_id||""==N.guide_depend_id?[]:JSON.parse(N.guide_depend_id),m=N.guide_condition,I=N.guide_scene,S=N.guide_priority,null==I&&console.error("\u5f15\u5bfc\u89e6\u53d1\u573a\u666f\u6709\u8bef",d,h),w={guide_id:G,guide_des:T,trigger_scene:I,guide_count_limit:y,guide_condition:m,guide_depend_id:v,guide_priority:S,steps:l},this.entranceMap.set(a.GUIDE_PREFIX+w.guide_id,w)}return[2]}})})},e.prototype.getEntranceVal=function(e){return this.entranceMap.get(a.GUIDE_PREFIX+e)},e.prototype.testtest=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e._guideParse.initAllGuide()];case 1:return i.sent(),this.enterGuide(t),[2]}})})},e.prototype.enterGuide=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=this.getEntranceVal(e),[4,u.guideManager.create(a.GUIDE_PREFIX+e,t)];case 1:return i.sent(),[4,u.guideManager.enter(a.GUIDE_PREFIX+e)];case 2:return i.sent(),[2]}})})},e.prototype.getGuideStorage=function(){var e=cc.sys.localStorage.getItem(a.GUIDE_PREFIX);return e instanceof Array&&e.length<1?null:null!=e?JSON.parse(e):{}},e.prototype.setGuideStorage=function(e){var t=this.getGuideStorage()||{};t[a.GUIDE_PREFIX+e]=null==t[a.GUIDE_PREFIX+e]?1:++t[a.GUIDE_PREFIX+e],cc.sys.localStorage.setItem(a.GUIDE_PREFIX,JSON.stringify(t)),Object.keys(t).map(function(e){return t[e]}).length==this.entranceMap.size&&console.warn("\u6240\u6709\u5f15\u5bfc\u5b8c\u6210")},e.prototype.clearAllGuideStorage=function(){cc.sys.localStorage.removeItem(a.GUIDE_PREFIX)},e.prototype.isCanGuide=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.initAllGuide()];case 1:return e.sent(),this.isGuiding()?[2,!0]:this.getCanRunGuide()?[2,!0]:[2,!1]}})})},e.prototype.isGuiding=function(){return 0!=u.guideManager.guides.size},e.prototype.getCanRunGuide=function(){var e=this;if(!this.isGuiding()){var t=[];this.entranceMap.forEach(function(e,i){t.push(e)});var i=this.getGuideStorage();return(t=t.filter(function(t){if(null!=i[a.GUIDE_PREFIX+t.guide_id]&&i[a.GUIDE_PREFIX+t.guide_id]>=t.guide_count_limit)return!1;for(var o=!1,n=0,s=t.guide_depend_id;n<s.length;n++){var r=s[n],c=e.getEntranceVal(r);if(null!=i[a.GUIDE_PREFIX+c.guide_id]&&i[a.GUIDE_PREFIX+c.guide_id]<c.guide_count_limit){o=!0;break}}return!o}))&&t[0]}},e.prototype.runNormalGuide=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return(e=this.getCanRunGuide())?[4,this.enterGuide(e.guide_id)]:[2];case 1:return t.sent(),[4,this.runNormalGuide()];case 2:return t.sent(),[2]}})})},e.prototype.runGuide=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,e._guideParse.initAllGuide()];case 1:return t.sent(),this.runNormalGuide(),[2]}})})},e.JsonURL="guide",e.INSTANCE=function(){return e._guideParse||(e._guideParse=new e),e._guideParse},e}();i.GuideParse=_,window.guideParse=_.INSTANCE(),cc._RF.pop()},{"../config/GuideConfig":"GuideConfig","../framework/GuideManager":"GuideManager"}],GuideStepHand:[function(e,t,i){"use strict";cc._RF.push(t,"b7687aW+bdPnavxnS3F27lx","GuideStepHand"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../entrance/GuideParse"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hand_tips=null,t.finger=null,t}return __extends(t,e),t.prototype.isShow=function(e){this.hand_tips.active=e},t.prototype.followHollowMask=function(e){this.node.setPosition(e.getPosition()),0==e.anchorX?this.node.x+=e.width/2:1==e.anchorX&&(this.node.x-=e.width/2),0==e.anchorY?this.node.y+=e.height/2:1==e.anchorY&&(this.node.y-=e.height/2)},t.prototype.showHand=function(e){switch(e.type||o.E_GUIDE_STEP_HAND_TIPS_TYPE.HIDE){case o.E_GUIDE_STEP_HAND_TIPS_TYPE.HIDE:this.hand_tips.active=!1;break;case o.E_GUIDE_STEP_HAND_TIPS_TYPE.SHOW:var t=e.targetNode;if(!t)return;this.hand_tips.active=!0,this.playAnime("NROMAL"),this.refreshHandPos(t),0==t.anchorX?this.node.x+=t.width/2:1==t.anchorX&&(this.node.x-=t.width/2),0==t.anchorY?this.node.y+=t.height/2:1==t.anchorY&&(this.node.y-=t.height/2)}},t.prototype.refreshHandPos=function(e){var t=e.convertToWorldSpaceAR(cc.Vec2.ZERO);t=this.hand_tips.parent.convertToNodeSpaceAR(t),this.hand_tips.setPosition(t)},t.prototype.playAnime=function(e){switch(void 0===e&&(e="NROMAL"),e){case"NROMAL":this.finger.stopAllActions(),this.finger.setPosition(50,-30),this.finger.runAction(cc.repeatForever(cc.sequence(cc.moveTo(.7,0,0),cc.moveTo(.7,50,-30))))}},__decorate([r(cc.Node)],t.prototype,"hand_tips",void 0),__decorate([r(cc.Node)],t.prototype,"finger",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"../entrance/GuideParse":"GuideParse"}],GuideStepMask:[function(e,t,i){"use strict";cc._RF.push(t,"91ae7gUAj9PU7cBTuIyz7mS","GuideStepMask"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,s=o.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hollow_mask=null,t.block_mask=null,t}return __extends(t,e),t.prototype.refreshMaskWidget=function(){this.block_mask.getComponent(cc.Widget).updateAlignment()},t.prototype.initMaskOpacity=function(e){void 0===e&&(e=150),this.stopMaskAnime(),this.hollow_mask.opacity=e},t.prototype.showMaskAnime=function(){this.hollow_mask.runAction(cc.fadeTo(1,150))},t.prototype.stopMaskAnime=function(){this.hollow_mask.stopAllActions()},t.prototype.activeHollowMaskComponent=function(e){this.hollow_mask.getComponent(cc.Mask).enabled=e},t.prototype.activInterceptComponent=function(e){this.block_mask.getComponent(cc.BlockInputEvents).enabled=e},t.prototype.activeMaskNode=function(e){this.hollow_mask.active=e},t.prototype.customMask=function(e){if(e){var t=e.offset_x,i=e.offset_y,o=e.width,n=e.height,s=e.offset_width,r=e.offset_height;null!=t&&(this.hollow_mask.x+=t),null!=i&&(this.hollow_mask.y+=i),null!=o&&(this.hollow_mask.width=o),null!=n&&(this.hollow_mask.height=n),null!=s&&(this.hollow_mask.width+=s),null!=r&&(this.hollow_mask.height+=r)}},t.prototype.showMask=function(e,t,i){void 0===i&&(i=!1);var o=e.convertToWorldSpaceAR(cc.Vec2.ZERO);o=this.hollow_mask.parent.convertToNodeSpaceAR(o),this.hollow_mask.setPosition(o),this.hollow_mask.setContentSize(e.getContentSize()),this.customMask(t),this.hollow_mask.anchorX=e.anchorX,this.hollow_mask.anchorY=e.anchorY,this.refreshMaskWidget(),i&&(this.initMaskOpacity(0),this.showMaskAnime())},t.prototype.followMask=function(e,t){if(e&&e.active){var i=e.convertToWorldSpaceAR(cc.Vec2.ZERO);i=this.hollow_mask.parent.convertToNodeSpaceAR(i),this.hollow_mask.setPosition(i),this.customMask(t),this.hollow_mask.anchorX=e.anchorX,this.hollow_mask.anchorY=e.anchorY,this.refreshMaskWidget()}},__decorate([s(cc.Node)],t.prototype,"hollow_mask",void 0),__decorate([s(cc.Node)],t.prototype,"block_mask",void 0),t=__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{}],GuideStepTips:[function(e,t,i){"use strict";cc._RF.push(t,"44480iOYNRJrIu2Tlwn+o8k","GuideStepTips"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../entrance/GuideParse"),n=cc._decorator,s=n.ccclass,r=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text_tips=null,t.text=null,t}return __extends(t,e),t.prototype.isShow=function(e){this.text_tips.active=e},t.prototype.setStr=function(e){this.text.string=e.str||"",this.text_tips.active=!0,this.text_tips.height=this.text.node.height+100;var t=cc.winSize.height;switch(e.pos||o.E_GUIDE_STEP_TIPS_TEXT_POSTION.CENTER){case o.E_GUIDE_STEP_TIPS_TEXT_POSTION.TOP:this.text_tips.y=t/2-this.text_tips.height;break;case o.E_GUIDE_STEP_TIPS_TEXT_POSTION.CENTER:this.text_tips.y=0;break;case o.E_GUIDE_STEP_TIPS_TEXT_POSTION.BOTTOM:this.text_tips.y=-t/2+this.text_tips.height;break;case o.E_GUIDE_STEP_TIPS_TEXT_POSTION.NODE:this.followMask(e.targetNode)}},t.prototype.followMask=function(e){if(e){var t=cc.winSize.height,i=e.convertToWorldSpaceAR(cc.Vec2.ZERO),o=t/2-(i=this.text_tips.parent.convertToNodeSpaceAR(i)).y>this.text_tips.height+50,n=i.y-t/2>this.text_tips.height+50;this.text_tips.y=n?i.y-this.text_tips.height/2-50:o?i.y+this.text_tips.height/2+50:i.y-this.text_tips.height/2-50}},__decorate([r({type:cc.Node,tooltip:"this.node"})],t.prototype,"text_tips",void 0),__decorate([r({type:cc.Label,tooltip:"\u6587\u672clabel"})],t.prototype,"text",void 0),t=__decorate([s],t)}(cc.Component);i.default=c,cc._RF.pop()},{"../entrance/GuideParse":"GuideParse"}],GuideStep:[function(e,t,i){"use strict";cc._RF.push(t,"38ad8MFCzVEDZFxDMjZYQG0","GuideStep"),Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.onInit=function(e){},e.prototype.onDestroy=function(){},e.prototype.exit=function(){},e.prototype.showNode=function(e){cc.director.getScene().getChildByName("Canvas").addChild(e,500)},e.prototype.removeNode=function(e){cc.isValid(e)&&e.removeFromParent(!1)},e.prototype.destroyNode=function(e){cc.isValid(e,!0)&&e.destroy()},e}();i.GuideStep=o,cc._RF.pop()},{}],Guide:[function(e,t,i){"use strict";cc._RF.push(t,"27969CnMVlH97xR3Jt3Z00M","Guide"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("../step/GuideNormalStep"),n=e("./GuideManager"),s=e("../config/GuideConfig"),r=function(){function e(){this.steping_data={ing:!1,now:0,break:!1,cur_step:null}}return e.prototype.init=function(e){this.data=e,this._destroyed=!1},e.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.exit())},e.prototype.exit=function(){var e=this.steping_data;e.ing&&e.cur_step&&e.cur_step.exit()},e.prototype.enter=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return(e=this.steping_data).ing?[2]:(e.ing=!0,e.now=0,e.break=!1,[4,this.enterStep(this.data.steps)]);case 1:return t.sent(),e.ing=!1,[2]}})})},e.prototype.enterStep=function(e){var t=this;return new Promise(function(i){var r=new o.GuideNormalStep;r.exit=function(){console.log("\u5355\u5f15\u5bfc\u7ed3\u675f",e[0].guide_id),r._destroyed=!0,r.onDestroy(),t.steping_data.cur_step=null,i(null),n.guideManager.remove(s.GUIDE_PREFIX+e[0].guide_id)},t.steping_data.cur_step=r,r._destroyed=!1,r.guide=t,r.onInit(e)})},e}();i.Guide=r,cc._RF.pop()},{"../config/GuideConfig":"GuideConfig","../step/GuideNormalStep":"GuideNormalStep","./GuideManager":"GuideManager"}],Test:[function(e,t,i){"use strict";cc._RF.push(t,"4c212Ix32VJba7sR7dPkncD","Test"),Object.defineProperty(i,"__esModule",{value:!0});var o=e("./event/EventNotice"),n=e("./guide/config/GuideConfig"),s=e("./guide/entrance/GuideParse"),r=cc._decorator,c=r.ccclass,a=r.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cocos1=null,t.cocos2=null,t.open=null,t.dialog=null,t.close=null,t.restart=null,t}return __extends(t,e),t.prototype.start=function(){var e=this;this.dialog.active=!1,this.scheduleOnce(function(){e.ttt()},1)},t.prototype.ttt=function(){var e=this;this.dialog.getChildByName("idle").on(cc.Node.EventType.TOUCH_END,function(e){e.target.stopAllActions(),e.target.runAction(cc.sequence(cc.callFunc(function(){e.target.color=cc.color(140,140,130)}),cc.scaleTo(.3,1.5),cc.scaleTo(.3,1),cc.callFunc(function(){e.target.color=cc.color(255,255,255)})))}),this.open.on(cc.Node.EventType.TOUCH_END,function(){e.dialog.active=!0}),this.close.on(cc.Node.EventType.TOUCH_END,function(){o.EventNotice.emit(n.E_GUIDE_CFG_FINISH_EVENT.CLICK_CLOSE),e.dialog.active=!1}),this.cocos1.on(cc.Node.EventType.TOUCH_END,function(e){e.target.runAction(cc.sequence(cc.scaleTo(.3,1.2),cc.scaleTo(.3,1)))}),this.cocos2.on(cc.Node.EventType.TOUCH_END,function(e){e.target.runAction(cc.sequence(cc.scaleTo(.3,1.2),cc.scaleTo(.3,1)))}),this.restart.on(cc.Node.EventType.TOUCH_END,function(e){s.GuideParse.INSTANCE().clearAllGuideStorage(),s.GuideParse.INSTANCE().runGuide()}),s.GuideParse.INSTANCE().runGuide()},__decorate([a(cc.Node)],t.prototype,"cocos1",void 0),__decorate([a(cc.Node)],t.prototype,"cocos2",void 0),__decorate([a(cc.Node)],t.prototype,"open",void 0),__decorate([a(cc.Node)],t.prototype,"dialog",void 0),__decorate([a(cc.Node)],t.prototype,"close",void 0),__decorate([a(cc.Node)],t.prototype,"restart",void 0),t=__decorate([c],t)}(cc.Component);i.default=u,cc._RF.pop()},{"./event/EventNotice":"EventNotice","./guide/config/GuideConfig":"GuideConfig","./guide/entrance/GuideParse":"GuideParse"}]},{},["Test","EventNotice","GuideConfig","GuideFunUtils","GuideParse","Guide","GuideManager","GuideStep","GuideNormalStep","GuideNormalStepUI","GuideStepHand","GuideStepMask","GuideStepTips"]);